name: Docker image build CI - build docker image.

on:
    release:
        types: [ published ]

jobs:
    docker:
        name: docker build and bush
        runs-on: ubuntu-latest

        steps:
            # https://github.com/actions/checkout
            -   name: Checkout codebase
                uses: actions/checkout@v2

            # https://github.com/docker/login-action
            -   name: Login to DockerHub
                uses: docker/login-action@v2
                with:
                    username: ${{ secrets.DOCKER_USERNAME }}
                    password: ${{ secrets.DOCKER_PASSWORD }}

            # https://github.com/docker/build-push-action
            -   name: Build and push
                id: docker_build
                uses: docker/build-push-action@v3
                with:
                    context: .
                    file: ./infrastructure/sdk.Dockerfile
                    platforms: linux/amd64
                    push: true
                    tags: spryker/php-sdk:${{ github.event.release.tag_name }}
                    labels: Release ${{ github.event.release.tag_name }}

